---
title: "å‹ã§åˆ†å²ã§ãã‚‹switchæ§‹æ–‡ â”€ sealedãƒ»recordã¨çµ„ã¿åˆã‚ã›ã‚‹å®Ÿè·µä¾‹ â”€"
emoji: "ğŸ¡"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["java", "jdk25", "sealed", "record", "ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒ"]
published: true
published_at: 2050-11-11 12:30
---
## ã¯ã˜ã‚ã«

Java 25 ã§ã¯ã€`switch`æ–‡ã§ **å‹ã”ã¨ã®åˆ†å²ï¼ˆPattern Matching for switchï¼‰** ãŒæ­£å¼ã«ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¾ã—ãŸã€‚  
ã“ã‚Œã«ã‚ˆã‚Šã€ã“ã‚Œã¾ã§ã®ã‚ˆã†ã« `instanceof` ã¨æ˜ç¤ºçš„ã‚­ãƒ£ã‚¹ãƒˆã‚’çµ„ã¿åˆã‚ã›ã¦ã„ãŸã‚³ãƒ¼ãƒ‰ã‚’ã€  
1ã¤ã® `switch` æ–‡ã§å®‰å…¨ã‹ã¤ã‚·ãƒ³ãƒ—ãƒ«ã«è¨˜è¿°ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

æœ¬è¨˜äº‹ã§ã¯ã€ã“ã®æ©Ÿèƒ½ã®æ¦‚è¦ã¨ã€å®Ÿå‹™ã§ã®å…·ä½“çš„ãªæ´»ç”¨ä¾‹ã‚’æ•´ç†ã—ã¾ã™ã€‚

## ğŸ“Š æ–°æ—§æ§‹æ–‡ã®æ¯”è¼ƒ

APIã‹ã‚‰å—ã‘å–ã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å‹ï¼ˆä¾‹ï¼š`Success`, `Error`ï¼‰ã«å¿œã˜ã¦ãƒ­ã‚°ã‚’å‡ºã—åˆ†ã‘ãŸã„å ´åˆã‚’è€ƒãˆã¾ã™

åŒæ§˜ã®å‡¦ç†ã‚’JDK16/JDK21ãã‚Œãã‚Œã§è¨˜è¿°ã—ã¦ã„ã¾ã™

### JDK16ä»¥å‰ï¼ˆå¾“æ¥æ§‹æ–‡ï¼‰

```java
if (res instanceof Success) {
    Success s = (Success) res;
    log.info("Success: {}", s.data());
} else if (res instanceof Error) {
    Error e = (Error) res;
    log.warn("Error: {}", e.message());
} else {
    log.info("unknown");
}
````

### JDK21ä»¥é™ï¼ˆPattern Matching for switchï¼‰

```java
switch (res) {
    case Success s -> log.info("Success: {}", s.data());
    case Error e   -> log.warn("Error: {}", e.message());
    default        -> log.info("unknown");
}
```

> ğŸ’¡ JDK21ã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å°å…¥ï¼ˆ[JEP 441](https://openjdk.org/jeps/441)ï¼‰ã€
> JDK25ã§æ­£å¼å¯¾å¿œï¼ˆ[JEP 455](https://openjdk.org/jeps/455)ï¼‰

---

### æ¯”è¼ƒã¾ã¨ã‚

| è¦³ç‚¹         | å¾“æ¥ï¼ˆJDK16ä»¥å‰ï¼‰               | æ–°æ§‹æ–‡ï¼ˆJDK21ä»¥é™ï¼‰          |
| ---------- | ------------------------- | --------------------- |
| å‹åˆ¤å®š        | `instanceof` + æ˜ç¤ºçš„ã‚­ãƒ£ã‚¹ãƒˆãŒå¿…è¦ | å‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ãƒãƒƒãƒã™ã‚Œã°è‡ªå‹•ã§å¤‰æ•°åˆ©ç”¨å¯  |
| å¯èª­æ€§        | if-elseãŒå¢—ãˆã‚‹ã¨ãƒã‚¹ãƒˆãŒæ·±ããªã‚‹      | å„å‹ã”ã¨ã«ã‚·ãƒ³ãƒ—ãƒ«ã«caseåˆ†å²      |
| å®‰å…¨æ€§        | ã‚­ãƒ£ã‚¹ãƒˆãƒŸã‚¹ã®ãƒªã‚¹ã‚¯ã‚ã‚Š              | ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒå‹æ•´åˆæ€§ã‚’ãƒã‚§ãƒƒã‚¯       |
| ã‚¹ã‚³ãƒ¼ãƒ—       | ã™ã¹ã¦ã®å¤‰æ•°ãŒåŒä¸€ã‚¹ã‚³ãƒ¼ãƒ—             | å„`case`ã”ã¨ã«ç‹¬ç«‹ã—ãŸã‚¹ã‚³ãƒ¼ãƒ—    |
| nullå‡¦ç†     | æ˜ç¤ºçš„ãƒã‚§ãƒƒã‚¯ãŒå¿…è¦                | `case null ->`ã§å®‰å…¨ã«æ‰±ãˆã‚‹ |
| sealedã¨ã®é€£æº | æ‰‹å‹•ã§å…¨åˆ†å²ç¢ºèªãŒå¿…è¦               | ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ç¶²ç¾…æ€§ã‚’æ¤œè¨¼         |

---

### è¦ç‚¹ã¾ã¨ã‚

* `switch`ã²ã¨ã¤ã§**å‹ã”ã¨ã®å®‰å…¨ãªåˆ†å²å‡¦ç†**ãŒå¯èƒ½ã«
* `sealed` / `record` ã¨çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€
  **ç¶²ç¾…æ€§ãƒã‚§ãƒƒã‚¯ Ã— ãƒ‰ãƒ¡ã‚¤ãƒ³è¡¨ç¾åŠ›å‘ä¸Š**ã‚’ä¸¡ç«‹
* å®Ÿå‹™ã§ã¯ãƒ­ã‚°å‡ºã—åˆ†ã‘ã€ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ã€èªè¨¼ãƒ»é€šçŸ¥ãƒãƒ³ãƒ‰ãƒ©ãªã©ã«æœ‰åŠ¹


## ğŸ§ª å®Ÿè·µ

`switch`ã«ã‚ˆã‚‹å‹ã”ã¨ã®åˆ†å²ã‚’ä¸‹è¨˜ã®3ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã¤ã„ã¦å®Ÿéš›ã«ã©ã®ã‚ˆã†ã«æ´»ç”¨ã§ãã‚‹ã‹ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚  

- ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†
- ãƒ‡ãƒ¼ã‚¿å¤‰æ›

### ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•å‡¦ç†ã§ã®å‹å®‰å…¨ãªåˆ†å²

Kafkaã‚„Pulsarãªã©ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°ã‚­ãƒ¥ãƒ¼ã‚ˆã‚Šã€è¤‡æ•°ã®ã‚¤ãƒ™ãƒ³ãƒˆå‹ã‚’å—ä¿¡ã—ã¦å‡¦ç†ã‚’åˆ†ã‘ãŸã„å ´åˆã€‚

```java
sealed interface DomainEvent permits UserRegistered, OrderPlaced, InventoryUpdated {}

record UserRegistered(String userId, String email) implements DomainEvent {}
record OrderPlaced(String orderId, int totalPrice) implements DomainEvent {}
record InventoryUpdated(String productId, int stockDelta) implements DomainEvent {}

void handle(DomainEvent event) {
    switch (event) {
        case UserRegistered e ->
            log.info("ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²: {}", e.email());
        case OrderPlaced e ->
            log.info("æ³¨æ–‡å—ä»˜: {} é‡‘é¡: {}", e.orderId(), e.totalPrice());
        case InventoryUpdated e ->
            log.info("åœ¨åº«æ›´æ–°: {} æ®‹æ•°å¤‰åŒ–: {}", e.productId(), e.stockDelta());
    }
}
```

> MQãªã©ã§å—ã‘å–ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã‚’ switch ä¸€ç™ºã§å‹å®‰å…¨ã«åˆ†å²å¯èƒ½
> æ–°ã—ã„ã‚¤ãƒ™ãƒ³ãƒˆå‹ã‚’è¿½åŠ ã—ãŸéš›ã‚‚ã€æœªå¯¾å¿œã®åˆ†å²ãŒã‚ã‚Œã°ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«æ¤œçŸ¥ã§ãã¾ã™

### ãƒ‡ãƒ¼ã‚¿å¤‰æ›å‡¦ç†

å—ã‘å–ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆJSON / CSV / XMLï¼‰ã‚’åˆ¤å®šã—ã¦ãƒ‘ãƒ¼ã‚µãƒ¼ã‚’å‘¼ã³åˆ†ã‘ã‚‹å ´åˆã§ã™

```java
sealed interface DataFormat permits JsonData, CsvData, XmlData {}

record JsonData(String content) implements DataFormat {}
record CsvData(String content) implements DataFormat {}
record XmlData(String content) implements DataFormat {}

static void parse(DataFormat data) {
    switch (data) {
        case JsonData j -> log.info("JSONã‚’è§£æ: {}", parseJson(j.content()));
        case CsvData c  -> log.info("CSVã‚’è§£æ: {}", parseCsv(c.content()));
        case XmlData x  -> log.info("XMLã‚’è§£æ: {}", parseXml(x.content()));
    }
}
```

> å‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«å¿œã˜ãŸå‡¦ç†åˆ†å²ã‚’
> **å®‰å…¨ã‹ã¤æ˜ç¤ºçš„ã«è¨˜è¿°**ã§ãã¾ã™ã€‚
> ã€Œãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆåˆ¤å®šâ†’ãƒ‘ãƒ¼ã‚µå‘¼ã³åˆ†ã‘ã€ã‚’è¡Œã†å…±é€šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ç‰¹ã«æœ‰åŠ¹ã€‚

### è£œè¶³ï¼šå‹åˆ†å²ãŒæ´»ãã‚‹å®Ÿå‹™ãƒ‰ãƒ¡ã‚¤ãƒ³ä¾‹ä¸€è¦§

| åˆ†é¡        | æƒ³å®šã‚±ãƒ¼ã‚¹                            | ã‚­ãƒ¼ã«ãªã‚‹å‹                                 |
| --------- | -------------------------------- | -------------------------------------- |
| ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•å‡¦ç†  | MQ / PubSub / Webhookã‚¤ãƒ™ãƒ³ãƒˆ        | `sealed interface Event permits ...`   |
| ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒªãƒ³ã‚° | å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€ã‚µãƒ–ã‚¿ã‚¤ãƒ—éšå±¤                  | `sealed interface` + `record`          |
| ãƒ‡ãƒ¼ã‚¿å¤‰æ›     | å…¥å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚„ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼                 | `sealed interface DataFormat`          |
| èªè¨¼å‡¦ç†      | Basic / Bearer / APIKeyãªã©æ–¹å¼åˆ¥ãƒãƒ³ãƒ‰ãƒ© | `sealed interface AuthScheme`          |
| é€šçŸ¥å‡¦ç†      | Email / Slack / WebPushãªã©é€ä¿¡æ‰‹æ®µ    | `sealed interface NotificationChannel` |
| æ±ºæ¸ˆå‡¦ç†      | ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ / PayPay / éŠ€è¡ŒæŒ¯è¾¼ãªã©          | `sealed interface PaymentMethod`       |

## ğŸ§¾ ã¾ã¨ã‚

* `switch`ã§å‹ã‚’æ‰±ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã€**å®‰å…¨ã§èª­ã¿ã‚„ã™ã„åˆ†å²å‡¦ç†**ãŒå¯èƒ½ã«
* `sealed` / `record`ã¨ä½µç”¨ã™ã‚‹ã“ã¨ã§ã€**ç¶²ç¾…æ€§ã¨æ‹¡å¼µæ€§ã®ä¸¡ç«‹**ã‚’å®Ÿç¾
* **ifãƒã‚§ãƒ¼ãƒ³ã‚’è„±å´ã—ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ§‹æ–‡ã§è¡¨ç¾**ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸ

## ğŸ”— å‚è€ƒ

* [JEP 394: Pattern Matching for instanceof (JDK17)](https://openjdk.org/jeps/394)
* [JEP 441: Pattern Matching for switch (JDK21 preview)](https://openjdk.org/jeps/441)
* [JEP 455: Pattern Matching for switch (JDK25 finalized)](https://openjdk.org/jeps/455)
* [Java 25 Migration Guide](https://docs.oracle.com/en/java/javase/25/migrate/significant-changes-jdk-25.html)
